---

- name: Kibana installation
  block:
    - name: Install the Kibana packages
      yum: name={{ kibana_packages }} state={{ kibana_package_state }} update_cache=yes

- name: Kibana configuration
  block:
    - name: Install the Kibana configuration
      template: src=kibana.yml.j2 dest=/etc/kibana/kibana.yml owner=root group=kibana mode=0644
      notify: Restart kibana
  
    - name: Install the Kibana httpd configuration
      template: src=kibana.conf.j2 dest=/etc/httpd/conf.d/kibana.conf owner=root group=kibana mode=0644
      notify: Restart kibana

- name: Create Kibana login
  htpasswd:
    path: /etc/kibana/users
    name: "{{ kibana_user }}"
    password: "{{ kibana_password }}"
    owner: root
    group: kibana
    mode: 0755
    notify: Restart kibana
